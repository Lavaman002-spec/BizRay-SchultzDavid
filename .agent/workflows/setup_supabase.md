---
description: Setup Supabase Auth and Database
---

# Supabase Setup Guide

Follow these steps to set up your Supabase project for BizRay.

## 1. Create a Supabase Project
1.  Go to [database.new](https://database.new) and sign in with GitHub.
2.  Click **"New Project"**.
3.  Enter a **Name** (e.g., `BizRay Dev`).
4.  Enter a strong **Database Password** (save this, you might need it later).
5.  Choose a **Region** close to you (e.g., `Central EU (Frankfurt)`).
6.  Click **"Create new project"**.

## 2. Get API Credentials
1.  Once the project is created (it takes a minute), go to **Project Settings** (cog icon at the bottom left).
2.  Click on **"API"** in the sidebar.
3.  Find the **Project URL** and **anon public** key.

## 3. Configure Authentication
1.  Go to the **Authentication** icon in the left sidebar.
2.  Click on **Providers**.
3.  Ensure **Email** is enabled (it usually is by default).
4.  (Optional) Disable "Confirm email" for faster development:
    - Go to **Authentication** -> **URL Configuration**.
    - Or **Authentication** -> **Providers** -> **Email** -> uncheck "Confirm email".

## 4. Run Database Migrations
You need to create the tables. You can run the SQL directly in the Supabase Dashboard.

1.  Go to the **SQL Editor** (icon with `>_` on the left).
2.  Click **"New query"**.
3.  Copy and paste the following SQL (this combines our schema):

```sql
-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- Companies Table
create table if not exists companies (
  id bigint generated by default as identity primary key,
  fnr text unique not null,
  name text not null,
  legal_form text,
  state text,
  city text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null,
  last_fetched_at timestamp with time zone
);

-- Company Officers
create table if not exists company_officers (
  id bigint generated by default as identity primary key,
  company_id bigint references companies(id) on delete cascade not null,
  title text,
  first_name text,
  last_name text,
  full_name text,
  role text,
  birth_date text,
  is_active boolean default true,
  vnr text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Company Addresses
create table if not exists company_addresses (
  id bigint generated by default as identity primary key,
  company_id bigint references companies(id) on delete cascade not null,
  street text,
  house_number text,
  stairway text,
  door_number text,
  postal_code text,
  city text,
  state text,
  country text default 'Austria',
  is_deliverable boolean default true,
  is_active boolean default true,
  vnr text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Company Activities
create table if not exists company_activities (
  id bigint generated by default as identity primary key,
  company_id bigint references companies(id) on delete cascade not null,
  description text not null,
  is_active boolean default true,
  vnr text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Exports
create table if not exists exports (
  id bigint generated by default as identity primary key,
  company_id bigint references companies(id) on delete cascade not null,
  export_type text not null,
  exported_at timestamp with time zone default timezone('utc'::text, now()) not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- User Watchlist
create table if not exists user_watchlist (
  id bigint generated by default as identity primary key,
  user_id uuid not null references auth.users(id),
  company_id bigint not null references companies(id),
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  unique(user_id, company_id)
);

-- Alerts
create table if not exists alerts (
  id bigint generated by default as identity primary key,
  user_id uuid not null references auth.users(id),
  company_id bigint not null references companies(id),
  type text not null,
  message text not null,
  is_read boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- RLS Policies
alter table user_watchlist enable row level security;
alter table alerts enable row level security;

create policy "Users can view their own watchlist" on user_watchlist for select using (auth.uid() = user_id);
create policy "Users can insert into their own watchlist" on user_watchlist for insert with check (auth.uid() = user_id);
create policy "Users can delete from their own watchlist" on user_watchlist for delete using (auth.uid() = user_id);

create policy "Users can view their own alerts" on alerts for select using (auth.uid() = user_id);
create policy "Users can update their own alerts" on alerts for update using (auth.uid() = user_id);

-- Public read access for companies data (optional, restrict if needed)
alter table companies enable row level security;
create policy "Public read access" on companies for select using (true);

alter table company_officers enable row level security;
create policy "Public read access" on company_officers for select using (true);

alter table company_addresses enable row level security;
create policy "Public read access" on company_addresses for select using (true);

alter table company_activities enable row level security;
create policy "Public read access" on company_activities for select using (true);
```

4.  Click **"Run"**.

## 5. Update Environment Variables
Provide the **Project URL** and **Anon Key** to the agent or update the `.env` files manually.
